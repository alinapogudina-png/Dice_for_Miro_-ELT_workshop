<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tool</title>
    <style>
        :root {
            --dice-background-color: #574FFF; /* Default for regular dice */
            --number-color: #FFFFFF; /* Default for dice numbers */
            --neon-color: #00FFFF;
        }
        html, body {
            width: 100vw;
            height: 100vh;
            margin: 0; padding: 0;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overflow: hidden; 
        }

        /* Main container for the tool. Ensures it's square and controls its shape. */
        .tool-container {
            width: 80%; /* Takes 80% of iframe's width */
            aspect-ratio: 1 / 1; /* FORCES a perfect square shape */
            max-width: 150px; 
            max-height: 150px; /* Limits overall size */
            position: relative;
            box-sizing: border-box; 
            display: flex; 
            justify-content: center;
            align-items: center;
            /* Default border-radius, will be set by JS dynamically */
            transition: border-radius 0.3s ease-out;
            /* No background or filter here to keep it clean */
        }
        
        /* General neon glow styles for elements that need filter: drop-shadow */
        /* Applied to image or number span */
        .neon-filter-glow {
            filter: drop-shadow(0 0 0.8vw var(--neon-color)) 
                    drop-shadow(0 0 1.5vw var(--neon-color)) 
                    drop-shadow(0 0 2.5vw var(--neon-color));
            transition: filter 0.3s ease-out;
        }

        /* General neon glow styles for elements that need box-shadow */
        /* Applied to the background div of the regular dice */
        .neon-box-glow {
            box-shadow: 0 0 1vw var(--neon-color), 0 0 2.5vw var(--neon-color), 0 0 5vw var(--neon-color);
            transition: box-shadow 0.3s ease-out;
        }


        /* --- Regular Dice specific styles --- */
        .dice-background { /* This div holds the background color and the number */
            width: 100%; height: 100%;
            border-radius: inherit; /* Inherit from tool-container */
            background-color: var(--dice-background-color);
            display: flex; justify-content: center; align-items: center;
            transition: background-color 0.3s ease-out;
        }

        .dice-number {
            color: var(--number-color); 
            font-size: 8vw; 
            min-font-size: 40px; 
            font-weight: bold;
            line-height: 1; 
            display: block; 
            animation: bounce 0.5s ease-out;
            transition: color 0.3s ease-out;
            /* drop-shadow for number is handled by .neon-filter-glow class */
        }

        /* --- Wooden Dice specific styles --- */
        .wood-image { /* Class directly on the img element */
            width: 100%; height: 100%;
            object-fit: cover; 
            border-radius: inherit; /* Inherit from tool-container */
            display: block;
            animation: bounce 0.5s ease-out;
            /* drop-shadow for img is handled by .neon-filter-glow class */
        }

        /* --- Coin specific styles --- */
        .coin-image { /* Class directly on the img element */
            width: 100%; height: 100%;
            object-fit: contain; 
            border-radius: inherit; /* Inherit from tool-container (will be 50%) */
            display: block;
            animation: coinFlipAnim 0.3s ease-out;
            /* drop-shadow for img is handled by .neon-filter-glow class */
        }

        @keyframes bounce {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes coinFlipAnim {
            0% { transform: rotateY(0deg) scale(0.8); opacity: 0; }
            100% { transform: rotateY(360deg) scale(1); opacity: 1; }
        }

        /* Responsive font size adjustments for very small containers */
        @media (max-width: 150px) {
             .dice-number { font-size: 50px; }
        }
        @media (max-width: 100px) {
             .dice-number { font-size: 30px; }
        }
    </style>
</head>
<body>
    <div id="toolContainer" class="tool-container">
        <!-- Content will be dynamically loaded/swapped by JS -->
    </div>

    <audio id="diceSoundEffect" src="https://files.catbox.moe/xk6v0c.mp3" preload="auto"></audio>
    <audio id="coinSoundEffect" src="https://files.catbox.moe/d36fio.mp3" preload="auto"></audio>

    <script>
        const toolContainer = document.getElementById('toolContainer');
        const diceSoundEffect = document.getElementById('diceSoundEffect');
        const coinSoundEffect = document.getElementById('coinSoundEffect');
        
        let isRolling = false;
        let enableDiceSound = false;
        let enableCoinSound = false;

        // Your Coin images
        const coinImages = {
            heads: 'https://i.postimg.cc/VN3JLz7b/10.png',
            tails: 'https://i.postimg.cc/760f5jcd/9.png'
        };

        // Your Wooden dice images for each face
        const woodDiceImages = {
            1: 'https://i.postimg.cc/vmp4HGP1/3.png',
            2: 'https://i.postimg.cc/SKwnNmZn/4.png',
            3: 'https://i.postimg.cc/GpZ4hbM8/5.png',
            4: 'https://i.postimg.cc/W4Qdbs97/6.png',
            5: 'https://i.postimg.cc/1twf8bT7/7.png',
            6: 'https://i.postimg.cc/tTWYs8fr/8.png'
        };

        function applySettings() {
            const params = new URLSearchParams(window.location.search);
            const root = document.documentElement;

            const isCoin = params.get('coin') === 'true';
            const isWood = params.get('wood') === 'true';
            const enableNeon = params.get('neon') === 'true'; 

            // Clear existing content and all custom classes
            toolContainer.innerHTML = '';
            toolContainer.classList.remove('neon-box-glow'); // Ensure any old box-shadow glow is removed
            toolContainer.style.backgroundColor = 'transparent'; // Reset background

            // Set border-radius for the tool-container based on type (for outer shape)
            toolContainer.style.borderRadius = isCoin ? '50%' : '20%';

            // Set neon color for root
            root.style.setProperty('--neon-color', params.get('neonColor') || '#00FFFF');

            enableDiceSound = params.get('diceSound') === 'true';
            enableCoinSound = params.get('coinSound') === 'true';

            let glowTargetElement; // This element will receive the glow class

            if (isCoin) {
                const coinImage = document.createElement('img');
                coinImage.id = 'coinImage';
                coinImage.className = 'coin-image'; // Apply class for styling
                coinImage.src = coinImages.heads;
                coinImage.alt = 'Coin Heads';
                toolContainer.appendChild(coinImage);
                glowTargetElement = coinImage; // Image gets drop-shadow
            } else if (isWood) {
                const woodDiceImage = document.createElement('img');
                woodDiceImage.id = 'woodDiceImage';
                woodDiceImage.className = 'wood-image'; // Apply class for styling
                woodDiceImage.src = woodDiceImages[1];
                woodDiceImage.alt = 'Wooden Dice Face 1';
                toolContainer.appendChild(woodDiceImage);
                glowTargetElement = woodDiceImage; // Image gets drop-shadow
            } else {
                // For regular dice, the background div gets the color and box-shadow glow
                const diceBackground = document.createElement('div');
                diceBackground.id = 'diceBackground';
                diceBackground.className = 'dice-background';
                toolContainer.appendChild(diceBackground);
                glowTargetElement = diceBackground; // Background div gets box-shadow glow

                const diceNumberSpan = document.createElement('span');
                diceNumberSpan.id = 'diceNumber';
                diceNumberSpan.className = 'dice-number';
                diceNumberSpan.textContent = '1';
                diceBackground.appendChild(diceNumberSpan); // Number is inside background div

                // Set background color for the dice background div
                diceBackground.style.backgroundColor = params.get('diceColor') || '#574FFF';
                root.style.setProperty('--number-color', params.get('numberColor') || '#FFFFFF');
            }

            // Apply appropriate neon glow class if enabled
            if (enableNeon && glowTargetElement) {
                if (glowTargetElement.classList.contains('dice-background')) {
                    glowTargetElement.classList.add('neon-box-glow');
                } else { // For coin-image and wood-image
                    glowTargetElement.classList.add('neon-filter-glow');
                }
            }
        }


        function rollTool() {
            if (isRolling) return;
            isRolling = true;

            const coinImageElement = toolContainer.querySelector('.coin-image');
            const woodImageElement = toolContainer.querySelector('.wood-image');
            const diceNumberSpan = toolContainer.querySelector('.dice-number');

            const isCoinMode = coinImageElement !== null;

            if (isCoinMode && enableCoinSound) {
                coinSoundEffect.currentTime = 0;
                coinSoundEffect.play().catch(e => console.warn("Failed to play coin sound:", e));
            } else if (!isCoinMode && enableDiceSound) {
                diceSoundEffect.currentTime = 0;
                diceSoundEffect.play().catch(e => console.warn("Failed to play dice sound:", e));
            }

            if (isCoinMode) {
                const randomSide = Math.random() < 0.5 ? 'heads' : 'tails';
                
                coinImageElement.style.animation = 'none';
                void coinImageElement.offsetWidth; 
                coinImageElement.style.animation = `coinFlipAnim 0.3s ease-out`;

                coinImageElement.src = coinImages[randomSide];
                coinImageElement.alt = 'Coin ' + randomSide.charAt(0).toUpperCase() + randomSide.slice(1);
                setTimeout(() => {
                    isRolling = false;
                }, 300);
            } else if (woodImageElement !== null) {
                const randomValue = Math.floor(Math.random() * 6) + 1;
                
                woodImageElement.style.animation = 'none';
                void woodImageElement.offsetWidth;
                woodImageElement.style.animation = `bounce 0.5s ease-out`;

                woodImageElement.src = woodDiceImages[randomValue];
                woodImageElement.alt = 'Wooden Dice Face ' + randomValue;
                setTimeout(() => {
                    isRolling = false;
                }, 500);
            } else if (diceNumberSpan !== null) { // Regular dice
                const randomValue = Math.floor(Math.random() * 6) + 1;
                
                diceNumberSpan.style.animation = 'none';
                void diceNumberSpan.offsetWidth;
                diceNumberSpan.style.animation = `bounce 0.5s ease-out`;

                diceNumberSpan.textContent = randomValue;
                setTimeout(() => {
                    isRolling = false;
                }, 500);
            }
        }

        // Event Listeners
        toolContainer.addEventListener('click', rollTool);

        // Initial setup
        applySettings();
        // Initial roll with a slight delay
        setTimeout(() => {
            rollTool();
        }, 50); 
    </script>
</body>
</html>
