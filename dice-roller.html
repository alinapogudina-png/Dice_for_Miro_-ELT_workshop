<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roller</title>
    <style>
        :root {
            --dice-color: #574FFF; /* Default dice color */
            --neon-color: #00FFFF;
            --animation-duration: 0.8s; /* normal */
        }
        html, body {
            width: 100vw;
            height: 100vh;
            margin: 0; padding: 0;
            overflow: hidden;
        }
        body {
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            -webkit-user-select: none; /* Disable text selection */
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .dice-container {
            width: 80%; /* Takes 80% of iframe's width/height */
            height: 80%;
            max-width: 150px; /* Maximum size for the dice */
            max-height: 150px;
            position: relative;
            border-radius: 20%; /* Softer corners */
            box-sizing: border-box; 
            background-color: var(--dice-color); /* Dice color set on container */
            display: flex; /* For centering the number */
            justify-content: center;
            align-items: center;
            /* No default box-shadow */
            box-shadow: none; 
            transition: box-shadow 0.3s ease-out; /* Smooth neon transition */
        }
        /* Neon effect applies to the main container */
        .dice-container.neon {
            box-shadow: 0 0 10px var(--neon-color), 0 0 25px var(--neon-color), 0 0 50px var(--neon-color);
        }

        .dice-number {
            color: #FFFFFF; /* White number by default */
            font-size: 8vw; /* Large and responsive font size */
            min-font-size: 40px; /* Minimum font size to prevent tiny numbers */
            font-weight: bold;
            line-height: 1; /* Ensure single line */
            display: block; /* To apply width/height correctly */
            /* Animation for the number */
            animation: bounce 0.5s ease-out;
        }

        @keyframes bounce {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Responsive font size adjustments for very small containers */
        @media (max-width: 150px) {
             .dice-number { font-size: 50px; }
        }
        @media (max-width: 100px) {
             .dice-number { font-size: 30px; }
        }
    </style>
</head>
<body>
    <div id="dice" class="dice-container">
        <span id="diceNumber" class="dice-number">1</span>
    </div>

    <audio id="diceSound" src="https://files.catbox.moe/xk6v0c.mp3" preload="auto"></audio>

    <script>
        const dice = document.getElementById('dice');
        const diceNumberSpan = document.getElementById('diceNumber');
        const diceSound = document.getElementById('diceSound');
        let isRolling = false;
        let enableSound = false;

        function applySettings() {
            const params = new URLSearchParams(window.location.search);
            const root = document.documentElement;

            root.style.setProperty('--dice-color', params.get('diceColor') || '#574FFF');
            
            // Neon effect
            if (params.get('neon') === 'true') {
                dice.classList.add('neon');
                root.style.setProperty('--neon-color', params.get('neonColor') || '#00FFFF');
            } else {
                dice.classList.remove('neon');
            }

            enableSound = params.get('sound') === 'true';

            let duration = '0.8s'; // normal
            switch (params.get('speed')) {
                case 'slow': duration = '1.2s'; break;
                case 'fast': duration = '0.4s'; break;
            }
            // The animation for the number is CSS-based now, this duration mainly for sound delay if any.
            // For now, it won't directly affect CSS animation, but kept for future.
            root.style.setProperty('--animation-duration', duration);
        }

        function rollDice() {
            if (isRolling) return;
            isRolling = true;

            // Play sound if enabled
            if (enableSound) {
                diceSound.currentTime = 0; // Reset sound to start
                diceSound.play().catch(e => console.warn("Failed to play dice sound:", e));
            }

            const randomValue = Math.floor(Math.random() * 6) + 1; // 1 to 6

            // Trigger animation and update number
            diceNumberSpan.style.animation = 'none'; // Reset animation
            void diceNumberSpan.offsetWidth; // Trigger reflow
            diceNumberSpan.style.animation = `bounce ${getComputedStyle(document.documentElement).getPropertyValue('--animation-duration')} ease-out`;
            diceNumberSpan.textContent = randomValue;
            
            setTimeout(() => {
                isRolling = false;
            }, parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--animation-duration')) * 1000);
        }

        // Event Listeners
        dice.addEventListener('click', rollDice);

        // Initial setup
        applySettings();
        // Initial random roll with a slight delay
        setTimeout(() => {
            rollDice();
        }, 50); 
    </script>
</body>
</html>
